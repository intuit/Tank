<?xml version="1.0" encoding="UTF-8"?>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
  xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
  xmlns:f="http://xmlns.jcp.org/jsf/core"
  xmlns:h="http://xmlns.jcp.org/jsf/html"
  xmlns:ts="http://xmlns.jcp.org/jsf/composite/tag"
  xmlns:p="http://primefaces.org/ui"
  xmlns:pe="http://primefaces.org/ui/extensions"
  template="/WEB-INF/templates/tank.xhtml">
  <ui:define name="content">

    <h:form id="scriptBrowserForm">
      <ts:toolbar title="Script: #{scriptEditor.script.name}" toolbarId="actionsTB" id="mainTB">
        <f:facet name="actions">

          <h:panelGroup id="layoutTB1" styleClass="toolbar-ui" layout="block">
            <p:commandButton id="tbSaveBT" value="Save" update=":scriptBrowserForm, :scriptBrowserForm:messages"
              onstart="saveScrollPos()" oncomplete="getScrollPos()" ajax="true"
              title="Save Changes to Script #{scriptEditor.script.name}" action="#{scriptEditor.save()}"
              icon="ui-icon-disk" style="margin: 0 5px 0 5px; border-radius:5px"
              styleClass="icon-button h-space" disabled="#{not scriptEditor.canEditScript()}" />

            <p:commandButton id="saveAsBt" value="Save As..." type="button" onstart="saveScrollPos()"
              oncomplete="getScrollPos()" icon="ui-icon-disk" style="margin: 0 5px 0 5px; border-radius:5px"
              styleClass="icon-button h-space" onclick="PF('saveAsConfirm').show()"
              disabled="#{not scriptEditor.canEditScript()}" />

            <p:commandButton id="tbCancelBtn" action="#{scriptEditor.cancel()}" value="Cancel" immediate="true"
              icon="ui-icon-cancel" styleClass="icon-button h-space" />

            <p:commandButton id="commentsBT" value="Comments" update=":commentsDialogId" ajax="true"
              title="Comments for #{scriptEditor.script.name}" oncomplete="PF('commentsDialog').show();"
              styleClass="icon-button h-space"
              icon="ui-icon-comment" style="margin: 0 5px 0 5px; border-radius:5px" />

            <p:commandButton id="searchBT" value="Search" ajax="true" immediate="true"
              action="#{scriptSearchBean.toggleSearching()}" update=":scriptBrowserForm"
              rendered="#{!scriptSearchBean.searching}" title="Search #{scriptEditor.script.name}"
              styleClass="icon-button h-space"
              icon="ui-icon-search" style="margin: 0 5px 0 5px; border-radius:5px" />

            <p:commandButton id="tbBackBtn" action="#{scriptSearchBean.toggleSearching()}" value="Back" ajax="true"
              update=":scriptBrowserForm, :scriptBrowserForm:scriptStepTableId" rendered="#{scriptSearchBean.searching}"
              immediate="true"
              icon="ui-icon-arrowrefresh-1-w" style="margin: 0 5px 0 5px; border-radius:5px"
              styleClass="icon-button h-space" oncomplete="PF('scriptStepTable').unselectAllRows();" />

            <p:commandButton id="reapplyFilters" action="#{scriptEditor.enterFilterMode()}" value="Apply Filters"
              ajax="true"
              icon="ui-icon-script" style="margin: 0 5px 0 5px; border-radius:5px"
              styleClass="icon-button h-space" />

            <p:commandButton id="validateScript" action="#{scriptEditor.createScriptDetails()}" value="Validate..."
              ajax="true" update=":validatePopupId" oncomplete="PF('validatePopup').show();"
              icon="ui-icon-check" style="margin: 0 5px 0 5px; border-radius:5px"
              styleClass="icon-button h-space" />
            <p:commandButton id="downloadHarnessBT" value="Harness XML" title="Download Harness XML"
              styleClass="icon-button h-space" type="button"
              onclick="location.href='#{request.contextPath}/rest/v1/script-service/download/harness/script/#{scriptEditor.script.id}'"
              icon="ui-icon-arrowstop-1-s" style="margin: 0 5px 0 5px; border-radius:5px" >
            </p:commandButton>
            <p:commandButton id="downloadTSBT" value="Intuit Tank XML" title="Download Intuit Tank XML"
              styleClass="icon-button h-space" type="button"
              onclick="location.href='#{request.contextPath}/rest/v1/script-service/download/script/#{scriptEditor.script.id}'"
              icon="ui-icon-arrowstop-1-s" style="margin: 0 5px 0 5px; border-radius:5px" >
            </p:commandButton>


          </h:panelGroup>

        </f:facet>
      </ts:toolbar>


      <div class="vertical-spacer" />
      <p:growl id="messages" />

      <div class="formDiv">

        <div class="formRow">
          <div class="formLabelDiv">
            <h:outputLabel value="Name" styleClass="formLabel required" />
          </div>
          <div class="formInputDiv">
            <p:inplace styleClass="block ellipsis" label="#{scriptEditor.scriptName}" editor="true"
              style="width: 200px;">
              <h:inputText value="#{scriptEditor.scriptName}" styleClass="formInput inputWidthMedium"
                style="width:140px;" />
            </p:inplace>
          </div>
        </div>

        <div class="formRow">
          <div class="formLabelDiv">
            <h:outputLabel for="productSelectionBox" value="Product" styleClass="formLabel" />
          </div>
          <div class="formInputDiv">
            <p:selectOneMenu id="productSelectionBox" value="#{scriptEditor.script.productName}">
              <f:selectItems value="#{projectUtilBean.productNames}" />
            </p:selectOneMenu>
          </div>
        </div>

        <div class="formRow">
          <ts:ownerBox entity="#{scriptEditor.script}"/>
        </div>
      </div>

      <h:panelGroup id="searchFieldGroup" rendered="#{scriptSearchBean.searching}">
        <div class="formDiv">
          <div class="formRow">
            <div class="formLabelDiv">
              <h:outputLabel for="searchString" value="Search Term: " styleClass="formLabel" />
            </div>
            <div class="formInputDiv">
              <p:watermark for="searchString" value="Keyword..." />
              <h:inputText id="searchString" value="#{scriptSearchBean.searchQuery}"
                styleClass="formInput inputWidthMedium" />
              <p:commandButton process="scriptBrowserForm" update=":scriptBrowserForm" value="Search"
                action="#{scriptSearchBean.runSearch()}">
              </p:commandButton>
              <p:commandButton value="Replace" action="#{scriptSearchBean.initReplacementDialog()}"
                oncomplete="PF('replaceDialog').show();" update=":replaceForm">
              </p:commandButton>
            </div>
          </div>
        </div>
      </h:panelGroup>

      <div class="clear-both vertical-spacer" />

      <div class="stepsTableDiv">
        <div class="v-space rf-tb pad2">
          <ts:toolbar title="" toolbarId="operationsTB" id="titleToolbar" rendered="#{!scriptSearchBean.searching}"
            showRightComponents="true">
            <f:facet name="actions">
              <h:panelGroup layout="block" styleClass="toolbar-ui">
                <p:menuButton id="insertMenuBT" value="Insert Step..." autoDisplay="true">
                  <p:menuitem value="Variable" action="#{variableEditor.insertVariable()}"
                    oncomplete="PF('variableDialog').show();" update=":variableDialogId" ajax="true" icon="ui-icon-document">
                  </p:menuitem>

                  <p:menuitem value="Think Time" action="#{thinkTimeEditor.insertThinkTime()}"
                    oncomplete="PF('thinkTimeDialog').show();" update=":thinkTimeDialogId" ajax="true" icon="ui-icon-clock">
                  </p:menuitem>
                  <p:menuitem value="Sleep Time" action="#{sleepTimeEditor.insertSleepTime()}"
                    oncomplete="PF('sleepTimeDialog').show();" update=":sleepTimeDialogId" ajax="true" icon="ui-icon-pause">
                  </p:menuitem>
                  <p:menuitem value="Request" update=":requestDialogId" action="#{scriptRequestEditor.insertRequest()}"
                    oncomplete="PF('requestDialog').show();" ajax="true" icon="ui-icon-extlink">
                  </p:menuitem>
                  <p:menuitem value="Logic" update=":logicDialogId" action="#{logicStepEditor.insertLogicStep()}"
                    oncomplete="PF('logicDialog').show();" ajax="true" icon="ui-icon-script">
                  </p:menuitem>
                  <p:menuitem value="Cookie" update=":cookieDialogId" action="#{cookieStepEditor.insertCookieStep()}"
                    oncomplete="PF('cookieDialog').show();" ajax="true" icon="ui-icon-tag">
                  </p:menuitem>
                  <p:menuitem value="Authentication" update=":authenticationDialogId" action="#{authenticationEditor.insertAuthentication()}"
                    oncomplete="PF('authenticationDialog').show();" ajax="true" icon="ui-icon-locked">
                  </p:menuitem>
                  <p:menuitem value="Clear Session" action="#{clearCookiesEditor.insert()}"
                    update=":scriptBrowserForm,:requestForm" ajax="true" icon="ui-icon-copy" onstart="saveScrollPos()"
                    oncomplete="getScrollPos()">
                  </p:menuitem>

                </p:menuButton>
                <h:panelGroup id="updateGroup">
                  <p:commandButton value="Delete Selected" onsuccess="PF('confirmMultiple').show();"
                    disabled="#{!scriptEditor.deleteEnabled}" update=":scriptBrowserForm:scriptStepTableId"
                    onstart="saveScrollPos()" oncomplete="getScrollPos()" styleClass="icon-button h-space"
                    icon="ui-icon-trash" />

                  <p:commandButton id="reorderBT" value="Reorder Steps" immediate="true" ajax="true"
                    oncomplete="PF('reorderDialog').show();" update=":reorderForm:reorderList"
                    styleClass="icon-button h-space"
                    icon="ui-icon-transfer-e-w" style="margin: 0 5px 0 5px; border-radius:5px" />

                  <p:commandButton value="Timer Group" immediate="true" ajax="true"
                    disabled="#{!aggregatorEditor.canBeAggregated}" id="aggregatorCBId" widgetVar="aggregatorCB"
                    oncomplete="PF('aggregatorDialog').show();" action="#{scriptEditor.addTimerGroup}"
                    update=":aggregatorDialogId" styleClass="icon-button h-space"
                    icon="ui-icon-transfer-e-w" style="margin: 0 5px 0 5px; border-radius:5px" />

                  <p:commandButton value="Copy Steps" immediate="true" ajax="true"
                    disabled="#{!scriptEditor.copyEnabled}" id="copyCB" action="#{scriptEditor.copySelected}"
                    update=":scriptBrowserForm:titleToolbar:updateGroup" styleClass="icon-button h-space"
                    icon="ui-icon-copy" style="margin: 0 5px 0 5px; border-radius:5px" />

                  <p:commandButton value="Paste Steps" immediate="true" ajax="true"
                    disabled="#{!copyBuffer.pasteEnabled}" id="pasteCB" action="#{scriptEditor.paste}"
                    update=":scriptBrowserForm:scriptStepTableId" styleClass="icon-button h-space"
                    onstart="saveScrollPos()" oncomplete="getScrollPos()"
                    icon="ui-icon-clipboard" style="margin: 0 5px 0 5px; border-radius:5px" />
                </h:panelGroup>
              </h:panelGroup>
            </f:facet>

            <f:facet name="additional-group">
              <p:selectCheckboxMenu id="visibilityList" value="#{scriptBean.stepTablePrefs.visibleColumns}"
                style="margin: 0 10px 0 20px;" panelStyle="width:300px;" label="Visible Columns...">
                <p:ajax event="change"
                  update=":scriptBrowserForm:scriptStepTableId, :scriptBrowserForm:searchScriptStepTableId"
                  process="@this" onstart="saveScrollPos()" oncomplete="getScrollPos()" immediate="true" />
                <p:ajax event="toggleSelect"
                  update=":scriptBrowserForm:scriptStepTableId, :scriptBrowserForm:searchScriptStepTableId"
                  process="@this" onstart="saveScrollPos()" oncomplete="getScrollPos()" immediate="true" />
                <f:selectItems value="#{scriptBean.stepTablePrefs.visibiltyList}" />
              </p:selectCheckboxMenu>
            </f:facet>
          </ts:toolbar>

          <p:fieldset legend="Search Options" rendered="#{scriptSearchBean.searching}">
            <h:panelGroup id="optionsPanel">
              <p:accordionPanel style="width:1024px;">
                <p:tab title="Request">
                  <p:dataGrid var="option" value="#{scriptSearchBean.requestSections}" columns="5"
                    styleClass="request-search-width">
                    <p:column>
                      <p:selectBooleanCheckbox value="#{option.selected}" />
                      <h:outputText value="#{option.label}"/>
                    </p:column>
                  </p:dataGrid>
                </p:tab>
                <p:tab title="Think Time">
                  <p:dataGrid var="option" value="#{scriptSearchBean.thinkTimeSections}" columns="5"
                    styleClass="think-search-width">
                    <p:column>
                      <p:selectBooleanCheckbox value="#{option.selected}" />
                      <h:outputText value="#{option.label}"/>
                    </p:column>
                  </p:dataGrid>
                </p:tab>
                <p:tab title="Sleep Time">
                  <p:dataGrid var="option" value="#{scriptSearchBean.sleepTimeSections}" columns="1"
                    styleClass="sleep-search-width">
                    <p:column>
                      <p:selectBooleanCheckbox value="#{option.selected}" />
                      <h:outputText value="#{option.label}"/>
                    </p:column>
                  </p:dataGrid>
                </p:tab>
                <p:tab title="Variable">
                  <p:dataGrid var="option" value="#{scriptSearchBean.variableSections}" columns="5"
                    styleClass="variable-search-width">
                    <p:column style="width:100px;">
                      <p:selectBooleanCheckbox value="#{option.selected}" />
                      <h:outputText value="#{option.label}"/>
                    </p:column>
                  </p:dataGrid>

                </p:tab>
              </p:accordionPanel>
            </h:panelGroup>
          </p:fieldset>
        </div>

        <ts:toolbar title="" toolbarId="operationsTBSearch" id="titleToolbarSearch"
          rendered="#{scriptSearchBean.searching}" showRightComponents="false"
          width="#{scriptEditor.tablePrefs.getMaxTotalSize(preferencesBean.screenWidth)}px">
          <f:facet name="actions">
            <h:panelGroup layout="block" styleClass="toolbar-ui">
              <h:panelGroup id="updateGroupSearch">
                <p:commandButton value="Delete Selected" onsuccess="PF('confirmMultiple').show();"
                  disabled="#{!scriptEditor.deleteEnabled}" update=":scriptBrowserForm:searchScriptStepTableId"
                  onstart="saveScrollPos()" oncomplete="getScrollPos()" styleClass="icon-button h-space"
                  icon="ui-icon-trash" />
              </h:panelGroup>
            </h:panelGroup>
          </f:facet>
        </ts:toolbar>

        <pe:remoteCommand id="resizeListener" name="resizeFinished" update="scriptStepTableId, searchScriptStepTableId" />
        <p:dataTable id="scriptStepTableId" var="step" rowKey="#{step.uuid}" value="#{scriptEditor.steps}"
          rowIndexVar="rowIndex" headerSectionClass="rf-tb" bodyRowClass="pointer" class="pad2"
          selection="#{scriptEditor.selectedSteps}" selectionMode="multiple" widgetVar="scriptStepTable"
          rendered="#{!scriptSearchBean.searching}" liveResize="false" scrollable="true" scrollHeight="100%"
          sortMode="single" paginator="true" rows="50" resizableColumns="true"
          paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink}  Rows per Page {RowsPerPageDropdown} Jump to Page {JumpToPageDropdown}"
                     currentPageReportTemplate="{startRecord}-{endRecord} of {totalRecords} records"
                     rowsPerPageTemplate="25,50,75,100,150,200,500,1000,5000">

          <p:ajax event="rowSelect" immediate="false" process="scriptStepTableId" global="false"
            update=":scriptBrowserForm:titleToolbar:updateGroup" listener="#{aggregatorEditor.aggregateCheck()}" />
          <p:ajax event="rowUnselect" immediate="false" process="scriptStepTableId" global="false"
            update=":scriptBrowserForm:titleToolbar:updateGroup" listener="#{aggregatorEditor.aggregateCheck()}" />
          <p:ajax event="colResize" update="scriptStepTableId" listener="#{scriptEditor.tablePrefs.onResize}"
            global="false" onstart="saveScrollPos()" oncomplete="getScrollPos()" immediate="true" />
          <p:ajax event="filter" listener="#{scriptEditor.tableState.onFilter}" global="false" immediate="true" />

          <f:facet name="header">
            <p:outputPanel style="text-align: right; width:100%" layout="block">
              <h:outputText value="Search all fields: " />
              <p:inputText id="globalFilter" onkeyup="PF('scriptStepTable').filter()" style="width:150px" />
            </p:outputPanel>
          </f:facet>

          <p:column id="indexColumn" styleClass="ellipsis" width="#{scriptBean.stepTablePrefs.getSize('indexColumn')}"
            rendered="#{scriptBean.stepTablePrefs.isVisible('indexColumn')}" sortBy="#{step.stepIndex}" sortOrder="asc"
            resizable="false">
            <h:outputText id="indexValue" value="#{step.stepIndex}" />
          </p:column>

          <p:column headerText="Group Name" id="groupColumn" styleClass="ellipsis min-column-size"
            width="#{scriptBean.stepTablePrefs.getSize('groupColumn')}"
            rendered="#{scriptBean.stepTablePrefs.isVisible('groupColumn')}"
            sortBy="#{step.scriptGroupName}"
            filterBy="#{step.scriptGroupName}" filterFunction="#{filterUtil.contains}" filterStyle="width:75px;">
            <h:outputText value="#{step.scriptGroupName}" style="width:75px;" />
          </p:column>

          <p:column headerText="Request Name" id="nameColumn" styleClass="ellipsis min-column-size"
            width="#{scriptBean.stepTablePrefs.getSize('nameColumn')}"
            rendered="#{scriptBean.stepTablePrefs.isVisible('nameColumn')}"
            filterBy="#{step.name}"
            filterFunction="#{filterUtil.contains}" filterStyle="width:75px;">
            <h:outputText value="#{step.name}" style="width:75px;" />
          </p:column>

          <p:column headerText="Method" id="methodColumn" styleClass="ellipsis min-column-size"
            width="#{scriptBean.stepTablePrefs.getSize('methodColumn')}"
            rendered="#{scriptBean.stepTablePrefs.isVisible('methodColumn')}"
            sortBy="#{step.method}"
            filterBy="#{step.method}" filterFunction="#{filterUtil.contains}" filterStyle="width:75px;">
            <h:outputText value="#{step.method}" style="width:75px;" />
          </p:column>

          <p:column headerText="Protocol" id="protocolColumn" styleClass="ellipsis min-column-size"
            width="#{scriptBean.stepTablePrefs.getSize('protocolColumn')}"
            rendered="#{scriptBean.stepTablePrefs.isVisible('protocolColumn')}"
            sortBy="#{step.protocol}"
            filterBy="#{step.protocol}" filterFunction="#{filterUtil.contains}" filterStyle="width:75px;">
            <h:outputText value="#{step.protocol}" style="width:75px;" />
          </p:column>

          <p:column headerText="Host" id="hostColumn" styleClass="ellipsis min-column-size"
            width="#{scriptBean.stepTablePrefs.getSize('hostColumn')}"
            rendered="#{scriptBean.stepTablePrefs.isVisible('hostColumn')}"
            sortBy="#{step.hostname}"
            filterBy="#{step.hostname}" filterFunction="#{filterUtil.contains}" filterStyle="width:75px;">
            <h:outputText value="#{step.hostname}" style="width:75px;" />
          </p:column>

          <p:column headerText="Path" id="pathColumn" styleClass="ellipsis min-column-size"
            width="#{scriptBean.stepTablePrefs.getSize('pathColumn')}"
            rendered="#{scriptBean.stepTablePrefs.isVisible('pathColumn')}"
            sortBy="#{step.simplePath}"
            filterBy="#{step.simplePath}" filterFunction="#{filterUtil.contains}" filterStyle="width:75px;">
            <h:outputText value="#{step.simplePath}" style="width:75px;" />
          </p:column>

          <p:column headerText="Data" id="dataColumn" styleClass="ellipsis min-column-size"
            width="#{scriptBean.stepTablePrefs.getSize('dataColumn')}"
            rendered="#{scriptBean.stepTablePrefs.isVisible('dataColumn')}"
            sortBy="#{step.label}"
            filterBy="#{step.label}" filterFunction="#{filterUtil.contains}" filterStyle="width:75px;">
            <p:commandLink id="linkVariable" update=":variableForm:variablePanelGroup" title="Edit Variable"
              rendered="#{scriptEditor.isVariable(step)}" action="#{scriptEditor.editVariable(step)}"
              styleClass="pointer" oncomplete="PF('variableDialog').show();">
              <h:outputText value="#{step.label}" styleClass="overflowEllipsis" title="#{step.label}" />
            </p:commandLink>
            <p:commandLink id="linkThinkTime" update=":thinkTimeForm:thinkTimePanelGroup" title="Edit "
              rendered="#{scriptEditor.isThinkTime(step)}" action="#{scriptEditor.editThinkTime(step)}"
              oncomplete="PF('thinkTimeDialog').show();">
              <h:outputText value="#{step.label}" styleClass="overflowEllipsis" title="#{step.label}" />
            </p:commandLink>
            <p:commandLink id="linkLogic" update=":logicForm:logicPanelGroup" title="Edit "
              rendered="#{scriptEditor.isLogicStep(step)}" action="#{scriptEditor.editLogicStep(step)}"
              oncomplete="PF('logicDialog').show();">
              <h:outputText value="#{step.label}" styleClass="overflowEllipsis" title="#{step.label}" />
            </p:commandLink>
            <p:commandLink id="linkCookie" update=":cookieForm:cookiePanelGroup" title="Edit "
              rendered="#{scriptEditor.isCookieStep(step)}" action="#{scriptEditor.editCookieStep(step)}"
              oncomplete="PF('cookieDialog').show();">
              <h:outputText value="#{step.label}" styleClass="overflowEllipsis" title="#{step.label}" />
            </p:commandLink>
            <p:commandLink id="linkAuth" update=":authenticationForm:authenticationPanelGroup" title="Edit "
              rendered="#{scriptEditor.isAuthStep(step)}" action="#{scriptEditor.editAuthStep(step)}"
              oncomplete="PF('authenticationDialog').show();">
              <h:outputText value="#{step.label}" styleClass="overflowEllipsis" title="#{step.label}" />
            </p:commandLink>
            <p:commandLink id="linkSleeptime" update=":sleepTimeForm:sleepTimePanelGroup" title="Edit Sleep Time"
              rendered="#{scriptEditor.isSleepTime(step)}" action="#{scriptEditor.editSleepTime(step)}"
              oncomplete="PF('sleepTimeDialog').show();">
              <h:outputText value="#{step.label}" styleClass="overflowEllipsis" title="#{step.label}" />
            </p:commandLink>
            <p:commandLink id="linkRequest" update=":requestForm:requestPanelGroup" title="Edit Request"
              rendered="#{scriptEditor.isRequest(step)}" action="#{scriptEditor.editRequest(step)}"
              oncomplete="PF('requestDialog').show();">
              <h:outputText value="#{step.label}" styleClass="overflowEllipsis" title="#{step.label}" />
            </p:commandLink>
            <p:commandLink id="linkAggregator" update=":aggregatorForm:aggregatorPanelGroup" title="Edit Aggregator"
              rendered="#{scriptEditor.isAggregator(step)}" action="#{scriptEditor.editAggregator(step)}"
              oncomplete="PF('aggregatorDialog').show();">
              <h:outputText value="#{step.label}" styleClass="overflowEllipsis" title="#{step.label}" />
            </p:commandLink>
          </p:column>

          <p:column headerText="MIME Type" id="mimeColumn" styleClass="ellipsis min-column-size"
            width="#{scriptBean.stepTablePrefs.getSize('mimeColumn')}"
            rendered="#{scriptBean.stepTablePrefs.isVisible('mimeColumn')}"
            sortBy="#{step.mimetype}"
            filterBy="#{step.mimetype}" filterFunction="#{filterUtil.contains}" filterStyle="width:75px;">
            <h:outputText value="#{step.mimetype}" style="width:75px;" />
          </p:column>

          <p:column headerText="Logging Key" id="loggingColumn" styleClass="ellipsis min-column-size"
            width="#{scriptBean.stepTablePrefs.getSize('loggingColumn')}"
            rendered="#{scriptBean.stepTablePrefs.isVisible('loggingColumn')}"
            ortBy="#{step.loggingKey}"
            filterBy="#{step.loggingKey}" filterFunction="#{filterUtil.contains}" filterStyle="width:75px;">
            <h:outputText value="#{step.loggingKey}" style="width:75px;" />
          </p:column>

          <p:column headerText="On Failure" id="failureColumn" styleClass="ellipsis min-column-size"
            width="#{scriptBean.stepTablePrefs.getSize('failureColumn')}"
            rendered="#{scriptBean.stepTablePrefs.isVisible('failureColumn')}"
            sortBy="#{step.onFail}"
            filterBy="#{step.onFail}" filterFunction="#{filterUtil.contains}" filterStyle="width:75px;">
            <h:outputText value="#{step.onFail}" style="width:75px;" />
          </p:column>

          <p:column headerText="Comments" id="commentsColumn" styleClass="ellipsis min-column-size"
            width="#{scriptBean.stepTablePrefs.getSize('commentsColumn')}"
            rendered="#{scriptBean.stepTablePrefs.isVisible('commentsColumn')}"
            sortBy="#{step.comments}"
            filterBy="#{step.comments}" filterFunction="#{filterUtil.contains}" filterStyle="width:75px;">
            <h:outputText value="#{step.comments}" style="width:75px;" />
          </p:column>

          <p:column headerText="Has Validation" id="validationColumn" styleClass="ellipsis min-column-size"
            width="#{scriptBean.stepTablePrefs.getSize('validationColumn')}"
            rendered="#{scriptBean.stepTablePrefs.isVisible('validationColumn')}"
            sortBy="#{step.hasValidation}"
            filterBy="#{step.hasValidation}" filterFunction="#{filterUtil.contains}" filterStyle="width:40px;">
            <h:outputText value="#{step.hasValidation}" title="#{step.hasValidation}" />
          </p:column>

          <p:column headerText="Has Assignments" id="assignmentColumn" styleClass="ellipsis min-column-size"
            width="#{scriptBean.stepTablePrefs.getSize('assignmentColumn')}"
            rendered="#{scriptBean.stepTablePrefs.isVisible('assignmentColumn')}"
            sortBy="#{step.hasAssignments}"
            filterBy="#{step.hasAssignments}" filterFunction="#{filterUtil.contains}" filterStyle="width:40px;">
            <h:outputText value="#{step.hasAssignments}" title="#{step.hasAssignments}" />
          </p:column>

          <p:column id="actionsColumn" styleClass="ellipsis actions-column-small"
            width="#{scriptBean.stepTablePrefs.getSize('actionsColumn')}"
            rendered="#{scriptBean.stepTablePrefs.isVisible('actionsColumn')}" resizable="false">
            <p:commandLink id="btnDel" action="#{scriptEditor.setCurrentStep(step)}" title="Delete #{step.label}"
              oncomplete="PF('confirmDelete').show();" ajax="true" update=":confirmDeleteDialogId">
              <h:graphicImage library="gfx" name="16/delete.png" width="16px" height="16px" style="pad2" />
            </p:commandLink>
            <p:commandLink id="btnOpenVariable" update=":variableForm:variablePanelGroup" title="Edit Variable"
              rendered="#{scriptEditor.isVariable(step)}" action="#{scriptEditor.editVariable(step)}"
              styleClass="pointer" oncomplete="PF('variableDialog').show();">
              <h:graphicImage library="gfx" name="16/document_editing.png" width="16px" height="16px"
                style="pad2" />
            </p:commandLink>
            <p:commandLink id="btnOpenThinkTime" update=":thinkTimeForm:thinkTimePanelGroup" title="Edit "
              rendered="#{scriptEditor.isLogicStep(step)}" action="#{scriptEditor.editThinkTime(step)}"
              oncomplete="PF('thinkTimeDialog').show();">
              <h:graphicImage library="gfx" name="16/document_editing.png" width="16px" height="16px"
                style="pad2" />
            </p:commandLink>
            <p:commandLink id="btnOpenLogic" update=":logicForm:logicPanelGroup" title="Edit "
              rendered="#{scriptEditor.isLogicStep(step)}" action="#{scriptEditor.editLogicStep(step)}"
              oncomplete="PF('logicDialog').show();">
              <h:graphicImage library="gfx" name="16/document_editing.png" width="16px" height="16px"
                style="pad2" />
            </p:commandLink>
            <p:commandLink id="btnOpenCookie" update=":cookieForm:cookiePanelGroup" title="Edit "
              rendered="#{scriptEditor.isCookieStep(step)}" action="#{scriptEditor.editCookieStep(step)}"
              oncomplete="PF('cookieDialog').show();">
              <h:graphicImage library="gfx" name="16/document_editing.png" width="16px" height="16px"
                style="pad2" />
            </p:commandLink>
            <p:commandLink id="btnOpenAuth" update=":authenticationForm:authenticationPanelGroup" title="Edit "
              rendered="#{scriptEditor.isAuthStep(step)}" action="#{scriptEditor.editAuthStep(step)}"
              oncomplete="PF('authenticationDialog').show();">
              <h:graphicImage library="gfx" name="16/document_editing.png" width="16px" height="16px"
                style="pad2" />
            </p:commandLink>

            <p:commandLink id="btnOpenSleeptime" update=":sleepTimeForm:sleepTimePanelGroup" title="Edit Sleep Time"
              rendered="#{scriptEditor.isSleepTime(step)}" action="#{scriptEditor.editSleepTime(step)}"
              oncomplete="PF('sleepTimeDialog').show();">
              <h:graphicImage library="gfx" name="16/document_editing.png" width="16px" height="16px"
                style="pad2" />
            </p:commandLink>
            <p:commandLink id="btnOpenRequest" update=":requestForm:requestPanelGroup" title="Edit Request"
              rendered="#{scriptEditor.isRequest(step)}" action="#{scriptEditor.editRequest(step)}"
              oncomplete="PF('requestDialog').show();">
              <h:graphicImage library="gfx" name="16/document_editing.png" width="16px" height="16px"
                style="pad2" />
            </p:commandLink>
            <p:commandLink id="btnOpenAggregator" update=":aggregatorForm:aggregatorPanelGroup" title="Edit Request"
              rendered="#{scriptEditor.isAggregator(step)}" action="#{scriptEditor.editAggregator(step)}"
              oncomplete="PF('aggregatorDialog').show();">
              <h:graphicImage library="gfx" name="16/document_editing.png" width="16px" height="16px"
                style="pad2" />
            </p:commandLink>
          </p:column>
        </p:dataTable>

        <p:dataTable id="searchScriptStepTableId" var="step" rowKey="#{step.uuid}"
          value="#{scriptSearchBean.searchMatch}" rowIndexVar="rowIndex" headerSectionClass="rf-tb"
          bodyRowClass="pointer" liveResize=" false" scrollable="true" selectionMode="multiple"
          selection="#{scriptEditor.selectedSteps}" scrollHeight="450" paginator="true" rows="50"
          resizableColumns="true"
          style="width:#{scriptEditor.tablePrefs.getMaxTotalSize(preferencesBean.screenWidth)}px;"
          paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} Rows per Page {RowsPerPageDropdown} Jump to Page {JumpToPageDropdown}"
          rowsPerPageTemplate="25,50,75,100,150,200,500,1000,5000" liveScroll="true" widgetVar="searchScriptStepTable"
          rendered="#{scriptSearchBean.searching}">

          <p:ajax event="rowSelect" immediate="false" process="searchScriptStepTableId"
            update=":scriptBrowserForm:titleToolbarSearch:updateGroupSearch"
            listener="#{aggregatorEditor.aggregateCheck()}" />
          <p:ajax event="rowUnselect" immediate="false" process="searchScriptStepTableId"
            update=":scriptBrowserForm:titleToolbarSearch:updateGroupSearch"
            listener="#{aggregatorEditor.aggregateCheck()}" />

          <p:ajax event="colResize" update="searchScriptStepTableId" listener="#{scriptEditor.tablePrefs.onResize}"
            global="true" onstart="saveScrollPos()" oncomplete="getScrollPos()" immediate="true" />

          <p:ajax event="filter" listener="#{scriptEditor.tableState.onFilter}" global="false" immediate="true" />


          <p:column id="indexColumn" styleClass="ellipsis" width="#{scriptBean.stepTablePrefs.getSize('indexColumn')}"
            rendered="#{scriptBean.stepTablePrefs.isVisible('indexColumn')}" sortBy="#{step.stepIndex}"
            resizable="false">
            <h:outputText id="indexValue" value="#{step.stepIndex}" title="" />
          </p:column>

          <p:column headerText="Group Name" id="groupColumn" styleClass="ellipsis min-column-size"
            width="#{scriptBean.stepTablePrefs.getSize('groupColumn')}"
            rendered="#{scriptBean.stepTablePrefs.isVisible('groupColumn')}"
            sortBy="#{step.scriptGroupName}"
            filterBy="#{step.scriptGroupName}" filterFunction="#{filterUtil.contains}" filterStyle="width:75px;">
            <h:outputText value="#{step.scriptGroupName}" title="#{step.scriptGroupName}" />
          </p:column>

          <p:column headerText="Request Name" id="nameColumn" styleClass="ellipsis min-column-size"
            width="#{scriptBean.stepTablePrefs.getSize('nameColumn')}"
            rendered="#{scriptBean.stepTablePrefs.isVisible('nameColumn')}"
            filterBy="#{step.name}"
            filterFunction="#{filterUtil.contains}" filterStyle="width:75px;">
            <h:outputText value="#{step.name}" title="#{step.name}" />
          </p:column>

          <p:column headerText="Method" id="methodColumn" styleClass="ellipsis min-column-size"
            width="#{scriptBean.stepTablePrefs.getSize('methodColumn')}"
            rendered="#{scriptBean.stepTablePrefs.isVisible('methodColumn')}"
            sortBy="#{step.method}"
            filterBy="#{step.method}" filterFunction="#{filterUtil.contains}" filterStyle="width:75px;">
            <h:outputText value="#{step.method}" title="#{step.method}" />
          </p:column>

          <p:column headerText="Protocol" id="protocolColumn" styleClass="ellipsis min-column-size"
            width="#{scriptBean.stepTablePrefs.getSize('protocolColumn')}"
            rendered="#{scriptBean.stepTablePrefs.isVisible('protocolColumn')}"
            sortBy="#{step.protocol}"
            filterBy="#{step.protocol}" filterFunction="#{filterUtil.contains}" filterStyle="width:75px;">
            <h:outputText value="#{step.protocol}" title="#{step.protocol}" />
          </p:column>

          <p:column headerText="Host" id="hostColumn" styleClass="ellipsis min-column-size"
            width="#{scriptBean.stepTablePrefs.getSize('hostColumn')}"
            rendered="#{scriptBean.stepTablePrefs.isVisible('hostColumn')}"
            sortBy="#{step.hostname}"
            filterBy="#{step.hostname}" filterFunction="#{filterUtil.contains}" filterStyle="width:75px;">
            <h:outputText value="#{step.hostname}" title="#{step.hostname}" />
          </p:column>

          <p:column headerText="Path" id="pathColumn" styleClass="ellipsis min-column-size"
            width="#{scriptBean.stepTablePrefs.getSize('pathColumn')}"
            rendered="#{scriptBean.stepTablePrefs.isVisible('pathColumn')}"
            sortBy="#{step.simplePath}"
            filterBy="#{step.simplePath}" filterFunction="#{filterUtil.contains}" filterStyle="width:75px;">
            <h:outputText value="#{step.simplePath}" title="#{step.simplePath}" />
          </p:column>

          <p:column headerText="Data" id="dataColumn" styleClass="ellipsis min-column-size"
            width="#{scriptBean.stepTablePrefs.getSize('dataColumn')}"
            rendered="#{scriptBean.stepTablePrefs.isVisible('dataColumn')}"
            sortBy="#{step.label}"
            filterBy="#{step.label}" filterFunction="#{filterUtil.contains}" filterStyle="width:75px;">
            <p:commandLink id="linkVariable" update=":variableForm:variablePanelGroup" title="Edit Variable"
              rendered="#{scriptEditor.isVariable(step)}" action="#{scriptEditor.editVariable(step)}"
              styleClass="pointer" oncomplete="PF('variableDialog').show();">
              <h:outputText value="#{step.label}" styleClass="overflowEllipsis" title="#{step.label}" />
            </p:commandLink>
            <p:commandLink id="linkThinkTime" update=":thinkTimeForm:thinkTimePanelGroup" title="Edit "
              rendered="#{scriptEditor.isThinkTime(step)}" action="#{scriptEditor.editThinkTime(step)}"
              oncomplete="PF('thinkTimeDialog').show();">
              <h:outputText value="#{step.label}" styleClass="overflowEllipsis" title="#{step.label}" />
            </p:commandLink>
            <p:commandLink id="linkLogic" update=":logicForm:logicPanelGroup" title="Edit "
              rendered="#{scriptEditor.isLogicStep(step)}" action="#{scriptEditor.editLogicStep(step)}"
              oncomplete="PF('logicDialog').show();">
              <h:outputText value="#{step.label}" styleClass="overflowEllipsis" title="#{step.label}" />
            </p:commandLink>
            <p:commandLink id="linkCookie" update=":cookieForm:cookiePanelGroup" title="Edit "
              rendered="#{scriptEditor.isCookieStep(step)}" action="#{scriptEditor.editCookieStep(step)}"
              oncomplete="PF('cookieDialog').show();">
              <h:outputText value="#{step.label}" styleClass="overflowEllipsis" title="#{step.label}" />
            </p:commandLink>
            <p:commandLink id="linkAuth" update=":authenticationForm:authenticationPanelGroup" title="Edit "
              rendered="#{scriptEditor.isAuthStep(step)}" action="#{scriptEditor.editAuthStep(step)}"
              oncomplete="PF('authenticationDialog').show();">
              <h:outputText value="#{step.label}" styleClass="overflowEllipsis" title="#{step.label}" />
            </p:commandLink>
            <p:commandLink id="linkSleeptime" update=":sleepTimeForm:sleepTimePanelGroup" title="Edit Sleep Time"
              rendered="#{scriptEditor.isSleepTime(step)}" action="#{scriptEditor.editSleepTime(step)}"
              oncomplete="PF('sleepTimeDialog').show();">
              <h:outputText value="#{step.label}" styleClass="overflowEllipsis" title="#{step.label}" />
            </p:commandLink>
            <p:commandLink id="linkRequest" update=":requestForm:requestPanelGroup" title="Edit Request"
              rendered="#{scriptEditor.isRequest(step)}" action="#{scriptEditor.editRequest(step)}"
              oncomplete="PF('requestDialog').show();">
              <h:outputText value="#{step.label}" styleClass="overflowEllipsis" title="#{step.label}" />
            </p:commandLink>
            <p:commandLink id="linkAggregator" update=":aggregatorForm:aggregatorPanelGroup" title="Edit Aggregator"
              rendered="#{scriptEditor.isAggregator(step)}" action="#{scriptEditor.editAggregator(step)}"
              oncomplete="PF('aggregatorDialog').show();">
              <h:outputText value="#{step.label}" styleClass="overflowEllipsis" title="#{step.label}" />
            </p:commandLink>
          </p:column>

          <p:column headerText="MIME Type" id="mimeColumn" styleClass="ellipsis min-column-size"
            width="#{scriptBean.stepTablePrefs.getSize('mimeColumn')}"
            rendered="#{scriptBean.stepTablePrefs.isVisible('mimeColumn')}"
            sortBy="#{step.mimetype}"
            filterBy="#{step.mimetype}" filterFunction="#{filterUtil.contains}" filterStyle="width:75px;">
            <h:outputText value="#{step.mimetype}" title="#{step.mimetype}" />
          </p:column>

          <p:column headerText="Logging Key" id="loggingColumn" styleClass="ellipsis min-column-size"
            width="#{scriptBean.stepTablePrefs.getSize('loggingColumn')}"
            rendered="#{scriptBean.stepTablePrefs.isVisible('loggingColumn')}"
            sortBy="#{step.loggingKey}"
            filterBy="#{step.loggingKey}" filterFunction="#{filterUtil.contains}" filterStyle="width:75px;">
            <h:outputText value="#{step.loggingKey}" title="#{step.loggingKey}" />
          </p:column>

          <p:column headerText="On Failure" id="failureColumn" styleClass="ellipsis min-column-size"
            width="#{scriptBean.stepTablePrefs.getSize('failureColumn')}"
            rendered="#{scriptBean.stepTablePrefs.isVisible('failureColumn')}"
            sortBy="#{step.onFail}"
            filterBy="#{step.onFail}" filterFunction="#{filterUtil.contains}" filterStyle="width:75px;">
            <h:outputText value="#{step.onFail}" title="#{step.onFail}" />
          </p:column>

          <p:column headerText="Comments" id="commentsColumn" styleClass="ellipsis min-column-size"
            width="#{scriptBean.stepTablePrefs.getSize('commentsColumn')}"
            rendered="#{scriptBean.stepTablePrefs.isVisible('commentsColumn')}"
            sortBy="#{step.comments}"
            filterBy="#{step.comments}" filterFunction="#{filterUtil.contains}" filterStyle="width:75px;">
            <h:outputText value="#{step.comments}" title="#{step.comments}" />
          </p:column>

          <p:column headerText="Has Validation" id="validationColumn" styleClass="ellipsis min-column-size"
            width="#{scriptBean.stepTablePrefs.getSize('validationColumn')}"
            rendered="#{scriptBean.stepTablePrefs.isVisible('validationColumn')}"
            sortBy="#{step.hasValidation}"
            filterBy="#{step.hasValidation}" filterFunction="#{filterUtil.contains}" filterStyle="width:40px;">
            <h:outputText value="#{step.hasValidation}" title="#{step.hasValidation}" />
          </p:column>
          <p:column headerText="Has Assignments" id="assignmentColumn" styleClass="ellipsis min-column-size"
            width="#{scriptBean.stepTablePrefs.getSize('assignmentColumn')}"
            rendered="#{scriptBean.stepTablePrefs.isVisible('assignmentColumn')}"
            sortBy="#{step.hasAssignments}"
            filterBy="#{step.hasAssignments}" filterFunction="#{filterUtil.contains}" filterStyle="width:40px;">
            <h:outputText value="#{step.hasAssignments}" title="#{step.hasAssignments}" />
          </p:column>

          <p:column id="actionsColumn" styleClass="ellipsis actions-column-small"
            width="#{scriptBean.stepTablePrefs.getSize('actionsColumn')}"
            rendered="#{scriptBean.stepTablePrefs.isVisible('actionsColumn')}" resizable="false">
            <p:commandLink id="btnDel" action="#{scriptEditor.setCurrentStep(step)}" title="Delete #{step.label}"
              oncomplete="PF('confirmDelete').show();" ajax="true" update=":confirmDeleteDialogId">
              <h:graphicImage library="gfx" name="16/delete.png" width="16px" height="16px" style="pad2" />
            </p:commandLink>

            <p:commandLink id="btnOpenVariable" update=":variableForm:variablePanelGroup" title="Edit Variable"
              rendered="#{scriptEditor.isVariable(step)}" action="#{scriptEditor.editVariable(step)}"
              styleClass="pointer" oncomplete="PF('variableDialog').show();">
              <h:graphicImage library="gfx" name="16/document_editing.png" width="16px" height="16px"
                style="pad2" />
            </p:commandLink>
            <p:commandLink id="btnOpenThinkTime" update=":thinkTimeForm:thinkTimePanelGroup" title="Edit "
              rendered="#{scriptEditor.isThinkTime(step)}" action="#{scriptEditor.editThinkTime(step)}"
              oncomplete="PF('thinkTimeDialog').show();">
              <h:graphicImage library="gfx" name="16/document_editing.png" width="16px" height="16px"
                style="pad2" />
            </p:commandLink>
            <p:commandLink id="btnOpenLogic" update=":logicForm:logicPanelGroup" title="Edit "
              rendered="#{scriptEditor.isLogicStep(step)}" action="#{scriptEditor.editLogicStep(step)}"
              oncomplete="PF('logicDialog').show();">
              <h:graphicImage library="gfx" name="16/document_editing.png" width="16px" height="16px"
                style="pad2" />
            </p:commandLink>
            <p:commandLink id="btnOpenCookie" update=":cookieForm:cookiePanelGroup" title="Edit "
              rendered="#{scriptEditor.isCookieStep(step)}" action="#{scriptEditor.editCookieStep(step)}"
              oncomplete="PF('cookieDialog').show();">
              <h:graphicImage library="gfx" name="16/document_editing.png" width="16px" height="16px"
                style="pad2" />
            </p:commandLink>
            <p:commandLink id="btnOpenAuth" update=":authenticationForm:authenticationPanelGroup" title="Edit "
              rendered="#{scriptEditor.isAuthStep(step)}" action="#{scriptEditor.editAuthStep(step)}"
              oncomplete="PF('authenticationDialog').show();">
              <h:graphicImage library="gfx" name="16/document_editing.png" width="16px" height="16px"
                style="pad2" />
            </p:commandLink>
            <p:commandLink id="btnOpenSleeptime" update=":sleepTimeForm:sleepTimePanelGroup" title="Edit Sleep Time"
              rendered="#{scriptEditor.isSleepTime(step)}" action="#{scriptEditor.editSleepTime(step)}"
              oncomplete="PF('sleepTimeDialog').show();">
              <h:graphicImage library="gfx" name="16/document_editing.png" width="16px" height="16px"
                style="pad2" />
            </p:commandLink>
            <p:commandLink id="btnOpenRequest" update=":requestForm:requestPanelGroup" title="Edit Request"
              rendered="#{scriptEditor.isRequest(step)}" action="#{scriptEditor.editRequest(step)}"
              oncomplete="PF('requestDialog').show();">
              <h:graphicImage library="gfx" name="16/document_editing.png" width="16px" height="16px"
                style="pad2" />
            </p:commandLink>
          </p:column>
        </p:dataTable>
      </div>

      <p:confirmDialog id="saveAsConfirmId" header="Save As"  widgetVar="saveAsConfirm">
        <f:facet name="message">
          <h:outputText value="Save As: " />
          <h:inputText value="#{scriptEditor.saveAsName}" styleClass="formInput inputWidthMedium" style="width:140px;" />
        </f:facet>
        <p:commandButton value="OK" id="SaveAsOk" ajax="false" action="#{scriptEditor.saveAs}" />
        <h:panelGroup styleClass="horizontal-spacer" />
        <p:commandButton value="Cancel" onclick="PF('saveAsConfirm').hide();" id="saveAsCancel" type="button" />
      </p:confirmDialog>
    </h:form>

    <p:dialog id="commentsDialogId" header="Comments for #{scriptEditor.script.name}" appendTo="@(body)" height="120"
      width="500" dynamic="true" widgetVar="commentsDialog" modal="true">
      <h:form id="commentForm">
        <h:panelGroup id="commentPanelGroup">
          <div class="formRow">
            <div class="smallFormLabelDiv float-left">
              <h:outputLabel for="commentsTF" value="Comments" styleClass="formLabel" />
            </div>
            <div style="width: 350px;" class="float-left">
              <h:inputTextarea value="#{scriptEditor.script.comments}" id="commentsTF" rows="3" cols="40"/>
            </div>
          </div>
          <div class="vertical-spacer" />
          <div>
            <p:commandButton value="Save" process=":commentsDialogId" update="@form" onstart="saveScrollPos()"
              oncomplete="getScrollPos()" onsuccess="PF('commentsDialog').hide();" />
          </div>
        </h:panelGroup>
      </h:form>
    </p:dialog>

    <p:dialog id="thinkTimeDialogId" header="Insert think time" appendTo="@(body)" height="150" width="500"
      dynamic="true" widgetVar="thinkTimeDialog" modal="true">
      <h:form id="thinkTimeForm">
        <h:panelGroup id="thinkTimePanelGroup">
          <ui:include src="./thinktime-editor.xhtml"/>
          <div class="vertical-spacer" />
          <p:commandButton value="#{thinkTimeEditor.buttonLabel}" update=":scriptBrowserForm,:thinkTimeForm"
            onstart="saveScrollPos()" oncomplete="getScrollPos()" process="thinkTimePanelGroup"
            action="#{thinkTimeEditor.addToScript()}" onsuccess="PF('thinkTimeDialog').hide();">
          </p:commandButton>
        </h:panelGroup>
      </h:form>
    </p:dialog>

    <p:dialog id="sleepTimeDialogId" header="Insert sleep time" appendTo="@(body)" height="100" width="500"
      dynamic="true" widgetVar="sleepTimeDialog" modal="true">
      <h:form id="sleepTimeForm">
        <h:panelGroup id="sleepTimePanelGroup">
          <ui:include src="./sleeptime-editor.xhtml"/>
          <div class="vertical-spacer" />
          <p:commandButton value="#{sleepTimeEditor.buttonLabel}" process="sleepTimePanelGroup"
            update=":scriptBrowserForm,:sleepTimeForm" action="#{sleepTimeEditor.addToScript()}"
            onstart="saveScrollPos()" oncomplete="getScrollPos()" onsuccess="PF('sleepTimeDialog').hide();">
          </p:commandButton>
        </h:panelGroup>
      </h:form>
    </p:dialog>

    <p:dialog id="requestDialogId" header="Insert Request" appendTo="@(body)" height="625" width="950" dynamic="true"
      widgetVar="requestDialog" modal="true">
      <h:form id="requestForm">
        <h:panelGroup id="requestPanelGroup">

          <ts:toolbar title="Request Editor" id="toolbar">
            <f:facet name="actions">
              <h:panelGroup>
                <p:commandButton id="tbSaveBtn" value="#{scriptRequestEditor.buttonLabel}"
                  title="Save Changes to script #{scriptEditor.script.name}" process=":requestForm:requestPanelGroup"
                  onstart="saveScrollPos()" oncomplete="getScrollPos()" update=":scriptBrowserForm,:requestForm"
                  action="#{scriptRequestEditor.addToScript()}" onsuccess="PF('requestDialog').hide();"
                  icon="ui-icon-disk" style="margin: 0 5px 0 5px; border-radius:5px"
                  styleClass="icon-button h-space" />
                <p:commandButton id="tbCancelBtn" value="Cancel" onclick="PF('requestDialog').hide()" type="button"
                  icon="ui-icon-cancel" styleClass="icon-button h-space" />
              </h:panelGroup>
            </f:facet>
          </ts:toolbar>
          <ui:include src="./request-editor.xhtml"/>
          <div class="vertical-spacer" />

        </h:panelGroup>
      </h:form>
    </p:dialog>

    <p:dialog id="variableDialogId" header="Insert Variable" appendTo="@(body)" height="150" width="500" dynamic="true"
      widgetVar="variableDialog" modal="true">
      <h:form id="variableForm">
        <h:panelGroup id="variablePanelGroup">
          <ui:include src="./variable-editor.xhtml"/>
          <div class="vertical-spacer" />
          <p:commandButton value="#{variableEditor.buttonLabel}" process="variablePanelGroup" onstart="saveScrollPos()"
            oncomplete="getScrollPos()" update=":scriptBrowserForm,:variableForm" onsuccess="PF('variableDialog').hide();"
            action="#{variableEditor.addToScript()}" />
        </h:panelGroup>
      </h:form>
    </p:dialog>

    <p:dialog id="aggregatorDialogId" header="Timer Group" appendTo="@(body)" height="150" width="300" dynamic="true"
      widgetVar="aggregatorDialog" modal="true">
      <h:form id="aggregatorForm">
        <h:panelGroup id="aggregatorPanelGroup">
          <ui:include src="./aggregator-editor.xhtml" />
          <div class="vertical-spacer" />
          <p:commandButton value="Save" process="aggregatorPanelGroup" update=":scriptBrowserForm:scriptStepTableId"
            onstart="saveScrollPos()" oncomplete="getScrollPos()" onsuccess="PF('aggregatorDialog').hide();"
            action="#{aggregatorEditor.addToScript()}" />
        </h:panelGroup>
      </h:form>
    </p:dialog>

    <p:dialog id="reorderDialogId" header="Reorder Steps" appendTo="@(body)" height="500" width="500" dynamic="true"
      widgetVar="reorderDialog" modal="true">
      <h:form id="reorderForm">
        <p:orderList id="reorderList" value="#{scriptEditor.orderList}" var="step" iconOnly="true" effect="clip"
          converter="tsScriptStepHolderConverter" itemValue="#{step}" controlsLocation="left"
          styleClass="scriptOrderMarker">
          <f:facet name="caption">Script Steps</f:facet>

          <p:column style="width:350px" styleClass="ellipsis">
            <div class="ellipsis" style="width: 340px;">
              <h:outputText value="#{step.index}" title="#{step.index}" style="margin-right: 5px;" />
              <h:outputText value="#{step.label}" title="#{step.label}" />
            </div>
          </p:column>
        </p:orderList>
        <div class="vertical-spacer">
          <p:commandButton value="Save" process=":reorderForm" update=":scriptBrowserForm:scriptStepTableId"
            onstart="saveScrollPos()" oncomplete="getScrollPos()" action="#{scriptEditor.reIndexAndCheck}"
            onsuccess="PF('reorderDialog').hide();" />
        </div>
      </h:form>
    </p:dialog>



    <p:confirmDialog id="confirmMultipleDelete"  widgetVar="confirmMultiple" header="Confirm Delete"
      message="Are you sure you want to delete the selected Script Steps?">
      <h:form id="confirmMultipleDeleteForm">
        <p:commandButton value="OK" id="confirmDeleteSelectedOkBtn" immediate="true"
          action="#{scriptEditor.deleteSelected()}" onsuccess="PF('confirmMultiple').hide()" onstart="saveScrollPos()"
          oncomplete="getScrollPos()"
          update=":scriptBrowserForm:scriptStepTableId, :scriptBrowserForm:searchScriptStepTableId, :scriptBrowserForm:messages"
          ajax="true" />
        <h:panelGroup styleClass="horizontal-spacer" />
        <p:commandButton value="Cancel" onclick="PF('confirmMultiple').hide();" type="button">
        </p:commandButton>
      </h:form>
    </p:confirmDialog>


    <p:dialog id="replaceDialogId" header="Replace" appendTo="@(body)" height="400" width="640" dynamic="true"
      widgetVar="replaceDialog" modal="true">
      <h:form id="replaceForm">

        <h:panelGroup id="replacePanelGroup">
          <div class="formRow">
            <div class="smallFormLabelDiv">
              <h:outputText value="Query: " />
            </div>
            <div class="smallFormInputDiv">
              <h:outputText value="'#{scriptSearchBean.searchQuery}'" />
            </div>
          </div>

          <div class="formRow">
            <div class="smallFormLabelDiv">
              <h:outputText value="Replace:" />
            </div>
            <div class="smallFormInputDiv">
              <h:inputText value="#{scriptSearchBean.replaceString}" id="replaceInput">
                <f:ajax event="keyup" execute="replaceInput" immediate="true" render="replaceEntityTableId"/>
              </h:inputText>
            </div>
          </div>

          <div class="formRow">
            <div class="smallFormLabelDiv">
              <h:outputText value="Replace Mode:" />
            </div>
            <div class="smallFormInputDiv">
              <p:selectOneMenu value="#{scriptSearchBean.replaceMode}" converter="tsReplaceModeConverter"
                style="margin-right: 20px;">
                <f:selectItems value="#{scriptSearchBean.replaceModeList}" var="replaceMode"
                  itemLabel="#{replaceMode.display}" itemValue="#{replaceMode.name()}" />
                <p:ajax event="change" immediate="true" update=":replaceForm" />
              </p:selectOneMenu>
            </div>
          </div>

          <h:panelGroup id="stepInfo">
            <div class="formRow">
              <strong><h:outputText value="Results Info:" /></strong>
            </div>

            <div class="formRow">
              <div class="smallFormLabelDiv">
                <h:outputText value="Step #:" />
              </div>
              <div class="smallFormInputDiv">
                <h:outputText rendered="#{scriptSearchBean.getCurrentScriptStep() != null}"
                  value="#{scriptSearchBean.index+1} / #{scriptSearchBean.searchMatchSize}" />
              </div>
            </div>

            <div class="formRow">
              <strong><h:outputText value="Step Info:" /></strong>
            </div>

            <div class="formRow">
              <div class="smallFormLabelDiv">
                <h:outputText value="Step Index:" />
              </div>
              <div class="smallFormInputDiv">
                <h:outputText rendered="#{scriptSearchBean.getCurrentScriptStep() != null}"
                  value="#{scriptSearchBean.getCurrentScriptStep().stepIndex}" />
              </div>
            </div>
          </h:panelGroup>

          <div class="formRow">
            <p:commandButton value="Next" action="#{scriptSearchBean.next()}" update="replaceEntityTableId, stepInfo" />
            <p:commandButton value="Previous" action="#{scriptSearchBean.previous()}"
              update="replaceEntityTableId, stepInfo" />
            <p:commandButton value="Replace" action="#{scriptSearchBean.replace()}"
              update="replaceEntityTableId, stepInfo, :scriptBrowserForm:searchScriptStepTableId" />
            <p:commandButton value="Replace All" action="#{scriptSearchBean.replaceAll()}"
              update="replaceEntityTableId, stepInfo, :scriptBrowserForm:searchScriptStepTableId" />
            <p:commandButton value="Replace Next X" action="#{scriptSearchBean.replaceNextX()}"
              update="replaceEntityTableId, stepInfo, :scriptBrowserForm:searchScriptStepTableId" />
            <p:inputText value="#{scriptSearchBean.nextX}" style="width:25px;" />
          </div>
        </h:panelGroup>

        <h:panelGroup id="replaceEntityPanelGroup">
          <p:dataTable id="replaceEntityTableId" var="entity" value="#{scriptSearchBean.replaceEntity}"
            resizableColumns="true" rowIndexVar="rowIndex" headerSectionClass="rf-tb" bodyRowClass="pointer"
            scrollable="true" scrollHeight="300" widgetVar="replaceEntityTable">

            <p:column id="indexColumn" styleClass="ellipsis" style="width:50px;min-width: 50px;max-width:50px;">
              <h:outputText value="#{rowIndex+1}" />
            </p:column>

            <p:column headerText="Section Name" id="sectionColumn" styleClass="ellipsis min-column-size"
              style="width:125px">
              <h:outputText value="#{entity.section.display}" />
            </p:column>

            <p:column headerText="Before (#{scriptSearchBean.replaceMode.display})" id="beforeColumn"
              styleClass="ellipsis min-column-size" style="width:150px">
              <h:outputText value="#{entity.getReplaced(scriptSearchBean.replaceMode)}" />
            </p:column>

            <p:column headerText="After" id="afterColumn" styleClass="ellipsis min-column-size" style="width:150px">
              <h:outputText value="#{entity.after}" />
            </p:column>
          </p:dataTable>
        </h:panelGroup>

      </h:form>
    </p:dialog>

    <p:dialog id="validatePopupId" appendTo="@(body)" dynamic="true" widgetVar="validatePopup" width="800" height="500"
      header="Validate Script" modal="true" resizable="true" position="center">
      <h:form id="validateForm">
        <p:scrollPanel style="width:90%;height:400px; padding:10px;" mode="native">
          <h:outputText value="#{scriptEditor.scriptDetails}" escape="false" />
        </p:scrollPanel>

        <div class="vertical-spacer" />

        <p:commandButton value="Close" type="button" styleClass="h-space" onclick="PF('validatePopup').hide();" />
      </h:form>
    </p:dialog>

    <p:confirmDialog id="confirmDeleteDialogId" appendTo="@(body)" widgetVar="confirmDelete" header="Confirm Delete"
      message="Are you sure you want to delete ScriptStep  #{scriptEditor.currentStep.label}?">
      <h:form id="confirmDeletemainForm">
        <p:commandButton value="OK" id="confirmDeleteOkBtnd"
          action="#{scriptEditor.deleteRequest(scriptEditor.currentStep)}" onsuccess="PF('confirmDelete').hide()"
          onstart="saveScrollPos()" oncomplete="getScrollPos()"
          update=":scriptBrowserForm, :scriptBrowserForm:messages " ajax="true" />
        <h:panelGroup styleClass="horizontal-spacer" />
        <p:commandButton value="Cancel" onclick="PF('confirmDelete').hide();" type="button">
        </p:commandButton>
      </h:form>
    </p:confirmDialog>

    <p:dialog id="logicDialogId" header="Insert Logic Step" appendTo="@(body)" height="500" width="1000" dynamic="true"
      widgetVar="logicDialog" modal="true">
      <h:form id="logicForm">
        <h:panelGroup id="logicPanelGroup">
          <ui:include src="./logic-editor.xhtml"/>
        </h:panelGroup>
      </h:form>
    </p:dialog>

    <p:dialog id="cookieDialogId" header="Insert Cookie" appendTo="@(body)" height="200" width="600" dynamic="true"
      widgetVar="cookieDialog" modal="true">
      <h:form id="cookieForm">
        <h:panelGroup id="cookiePanelGroup">
          <ui:include src="./set-cookie-editor.xhtml"/>
          <div class="vertical-spacer" />
  
          <p:commandButton value="#{cookieStepEditor.buttonLabel}" update=":scriptBrowserForm,:cookieForm"
            action="#{cookieStepEditor.addToScript()}" onstart="saveScrollPos()" oncomplete="getScrollPos()"
            onsuccess="PF('cookieDialog').hide();">
          </p:commandButton>
        </h:panelGroup>
      </h:form>
    </p:dialog>

    <p:dialog id="authenticationDialogId" header="Insert Authentication" appendTo="@(body)" height="400" width="600" dynamic="true"
      widgetVar="authenticationDialog" modal="true">
      <h:form id="authenticationForm">
        <h:panelGroup id="authenticationPanelGroup">
          <ui:include src="./authentication-editor.xhtml" />
          <div class="vertical-spacer" />
          <p:commandButton value="#{authenticationEditor.buttonLabel}" update=":scriptBrowserForm,:authenticationForm"
            action="#{authenticationEditor.addToScript()}" onstart="saveScrollPos()" oncomplete="getScrollPos()"
            onsuccess="PF('authenticationDialog').hide();" />
        </h:panelGroup>
      </h:form>
    </p:dialog>

    <p:dialog id="logicOutputDialogId" widgetVar="logicOutputDialog" header="Test Output" dynamic="true" width="600"
      height="400">
      <h:form id="logicOutputForm">
        <h:panelGroup id="logicOutputGroup">
          <p:scrollPanel>
            <pre>
          <h:outputText value="#{logicStepEditor.output}" escape="false" />
          </pre>
          </p:scrollPanel>
        </h:panelGroup>
      </h:form>
    </p:dialog>

    <p:dialog id="rawResponseDialogID" widgetVar="rawResponseDialog" header="Raw Response" dynamic="true" width="600"
      height="400">
      <h:form id="rawResponseForm">
        <h:panelGroup id="rawResponseGroup" rendered="#{scriptRequestEditor.step ne null}">
        <pre><h:outputText value="#{scriptEditor.getPrettyString(scriptRequestEditor.step.response, scriptRequestEditor.step.respFormat)}"/></pre>
        </h:panelGroup>
      </h:form>
    </p:dialog>



    <p:dialog id="logicDataDialogID" appendTo="@(body)" widgetVar="logicDataDialog" width="900" height="600"
      header="Logic Step Test Data" modal="true" resizable="true" position="center" minWidth="900">
      <h:form id="logicDataForm">
        <h:panelGroup id="logicDataGroup">
          <div>This is data used for thetesting of your script. It is originally pulled from the request
            immediately before the logic step but you can change any values that you wish.</div>
          <p:commandButton value="Get Values from previous request" immediate="true"
            action="#{logicStepEditor.setValuesFromPrevious}" update=":logicDataForm:logicDataGroup" />

          <div class="formRow">
            <div class="formLabelDiv required">Request Body</div>
            <div class="formInputDiv">
              <p:inputTextarea value="#{logicStepEditor.logicTestData.requestBody}" autoResize="false"
                style="width:600px;height:150px;" />
            </div>
          </div>

          <div class="vertical-spacer" />

          <div class="formRow">
            <div class="formLabelDiv required">Response Body</div>
            <div class="formInputDiv">
              <p:inputTextarea value="#{logicStepEditor.logicTestData.responseBody}" autoResize="false"
                style="width:600px;height:150px;" />
            </div>
          </div>

          <div class="vertical-spacer" />

          <div class="formRow">
            <div class="formLabelDiv required">Variables</div>
            <div class="formInputDiv">
              <p:commandButton value="Add Variable" immediate="true"
                action="#{logicStepEditor.logicTestData.newMapValue(logicStepEditor.logicTestData.varMap)}"
                onsuccess="PF('inputVarDialog').hide();PF('inputVarDialog').show();" update=":inputVarForm:inputVarGroup" />
              <p:dataTable value="#{logicStepEditor.logicTestData.variables}" var="var" id="testVarTable"
                styleClass="striped highlight" resizableColumns="true"
                emptyMessage="Click 'Add Variable' to add new values">

                <p:column width="100" headerText="name">
                  <h:outputText value="#{var.key}" />
                </p:column>

                <p:column width="100" headerText="value">
                  <p:inplace styleClass="ellipsis" editor="true">
                    <p:inputText value="#{var.value}" />
                  </p:inplace>
                </p:column>

                <p:column width="40" headerText="Remove">
                  <p:commandButton action="#{logicStepEditor.logicTestData.removeVariable(var.key)}" update="@form"
                    icon="ui-icon ui-icon-close" title="Delete">
                  </p:commandButton>
                </p:column>
              </p:dataTable>
            </div>
          </div>

          <div class="vertical-spacer" />

          <div class="formRow">
            <div class="formLabelDiv required">Request Headers</div>
            <div class="formInputDiv">
              <p:commandButton value="Add Request Header" immediate="true"
                action="#{logicStepEditor.logicTestData.newMapValue(logicStepEditor.logicTestData.requestHeaderMap)}"
                onsuccess="PF('inputVarDialog').hide();PF('inputVarDialog').show();" update=":inputVarForm:inputVarGroup" />
              <p:dataTable value="#{logicStepEditor.logicTestData.requestHeaders}" var="var" id="testRequestHeaderTable"
                styleClass="striped highlight" resizableColumns="true"
                emptyMessage="Click 'Add Request Header' to add new values">

                <p:column width="100" headerText="name">
                  <h:outputText value="#{var.key}" />
                </p:column>

                <p:column width="100" headerText="value">
                  <p:inplace styleClass="ellipsis" editor="true" style="width: 100px;">
                    <p:inputText value="#{var.value}" style="width: 100px;" />
                  </p:inplace>
                </p:column>

                <p:column width="40" headerText="Remove">
                  <p:commandButton action="#{logicStepEditor.logicTestData.removeRequestHeader(var.key)}" update="@form"
                    icon="ui-icon ui-icon-close" title="Delete">
                  </p:commandButton>
                </p:column>
              </p:dataTable>
            </div>
          </div>

          <div class="vertical-spacer" />

          <div class="formRow">
            <div class="formLabelDiv required">Response Headers</div>
            <div class="formInputDiv">
              <p:commandButton value="Add Response Header" immediate="true"
                action="#{logicStepEditor.logicTestData.newMapValue(logicStepEditor.logicTestData.responseHeaderMap)}"
                onsuccess="PF('inputVarDialog').hide();PF('inputVarDialog').show();" update=":inputVarForm:inputVarGroup" />
              <p:dataTable value="#{logicStepEditor.logicTestData.responseHeaders}" var="var"
                id="testResponseHeaderTable" emptyMessage="Click 'Add Response Header' to add new values"
                styleClass="striped highlight" resizableColumns="true">

                <p:column width="100" headerText="name">
                  <h:outputText value="#{var.key}" />
                </p:column>

                <p:column width="100" headerText="value">
                  <p:inplace styleClass="ellipsis" editor="true" style="width: 100px;">
                    <p:inputText value="#{var.value}" style="width: 100px;" />
                  </p:inplace>
                </p:column>

                <p:column width="40" headerText="Remove">
                  <p:commandButton action="#{logicStepEditor.logicTestData.removeResponseHeader(var.key)}"
                    update="@form" icon="ui-icon ui-icon-close" title="Delete">
                  </p:commandButton>
                </p:column>
              </p:dataTable>
            </div>
          </div>



        </h:panelGroup>
        <div class="vertical-spacer" />
        <p:commandButton value="Save" process="@form" onstart="saveScrollPos()" oncomplete="getScrollPos()"
          onsuccess="PF('logicDataDialog').hide();" />
        <p:commandButton value="Close" type="button" styleClass="h-space" onclick="PF('logicDataDialog').hide();" />
      </h:form>
    </p:dialog>

    <p:dialog appendTo="@(body)" id="inputVarDialogID" widgetVar="inputVarDialog" width="300" height="200"
      header="Add Value" modal="true" resizable="true" position="center">
      <h:form id="inputVarForm">
        <h:panelGroup id="inputVarGroup">
          <div class="formRow">
            <div class="smallFormLabelDiv required">Name</div>
            <div class="smallFormInputDiv">
              <h:inputText value="#{logicStepEditor.logicTestData.newKey}" style="width: 150px;" />
            </div>
          </div>

          <div class="formRow">
            <div class="smallFormLabelDiv required">Value</div>
            <div class="smallFormInputDiv">
              <h:inputText value="#{logicStepEditor.logicTestData.newValue}" style="width: 150px;" />
            </div>
          </div>
        </h:panelGroup>
        <div class="vertical-spacer" />
        <p:commandButton value="Save" process="@form" action="#{logicStepEditor.logicTestData.addMapValue()}"
          onsuccess="PF('inputVarDialog').hide();" update=":logicDataForm:logicDataGroup" />
        <p:commandButton value="Close" type="button" styleClass="h-space" onclick="PF('inputVarDialog').hide();" />
      </h:form>
    </p:dialog>

  </ui:define>
</ui:composition>
