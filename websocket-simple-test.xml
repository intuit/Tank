<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<ns2:workload xmlns:ns2="urn:com/intuit/tank/harness/data/v1" name="Local WebSocket Test" description="Tank WebSocket test
  against local ws://localhost:8080 service - Session Model">
      <client-class>com.intuit.tank.httpclientjdk.TankHttpClientJDK</client-class>
      <plan testPlanName="Main" userPercentage="100">
          <testSuite name="Group-1" description="WebSocket Session Test" loop="1">
              <testGroup name="Local WebSocket Test" loop="1">
                  <useCase>
                      <!-- CONNECT: Opens connection, creates MessageStream, registers fail-on patterns -->
                      <testStep xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:type="ns2:webSocketStep" name="Connect"
  action="connect" connectionId="echo" onFail="abort">
                          <stepIndex>0</stepIndex>
                          <request>
                              <url>ws://localhost:8080/ws/test</url>
                              <timeoutMs>5000</timeoutMs>
                          </request>
                          <fail-on pattern="error" />
                          <fail-on pattern="failed" />
                      </testStep>

                      <!-- SEND: Fire-and-forget, responses collected in background -->
                      <testStep xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:type="ns2:webSocketStep" name="Send
  Message 1" action="send" connectionId="echo" onFail="abort">
                          <stepIndex>1</stepIndex>
                          <request>
                              <payload>Hello WebSocket!</payload>
                          </request>
                      </testStep>

                      <!-- SLEEP: Allow time for server to respond -->
                      <testStep xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:type="ns2:sleepTimeStep">
                          <stepIndex>2</stepIndex>
                          <minTime>500</minTime>
                          <maxTime>500</maxTime>
                      </testStep>

                      <!-- SEND: Another message -->
                      <testStep xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:type="ns2:webSocketStep" name="Send
  Message 2" action="send" connectionId="echo" onFail="abort">
                          <stepIndex>3</stepIndex>
                          <request>
                              <payload>Second message</payload>
                          </request>
                      </testStep>

                      <!-- SLEEP: Allow time for server to respond -->
                      <testStep xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:type="ns2:sleepTimeStep">
                          <stepIndex>4</stepIndex>
                          <minTime>500</minTime>
                          <maxTime>500</maxTime>
                      </testStep>

                      <!-- DISCONNECT: Runs assertions against collected messages, then closes -->
                      <testStep xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:type="ns2:webSocketStep"
  name="Disconnect and Assert" action="disconnect" connectionId="echo" onFail="abort">
                          <stepIndex>5</stepIndex>
                          <assertions>
                              <expect pattern="Echo: Hello WebSocket!" minCount="1" />
                              <expect pattern="Echo: Second message" minCount="1" />
                              <save pattern="Echo: (.+)" variable="lastEcho" occurrence="last" />
                          </assertions>
                      </testStep>
                  </useCase>
              </testGroup>
          </testSuite>
      </plan>
  </ns2:workload>
